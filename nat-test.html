<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>NAT ç±»å‹æ£€æµ‹</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      padding: 20px;
    }
    h1 { color: #38bdf8; }
    button {
      padding: 10px 16px;
      background: #38bdf8;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
    }
    button:disabled { opacity: 0.6; cursor: not-allowed; }
    .box {
      margin-top: 20px;
      padding: 15px;
      background: #020617;
      border-radius: 8px;
    }
    .ok { color: #22c55e; }
    .warn { color: #facc15; }
    .bad { color: #ef4444; }
    code { color: #93c5fd; }
  </style>
</head>
<body>

<h1>ğŸŒ NAT ç±»å‹æ£€æµ‹</h1>
<p>åŸºäº WebRTC STUN æ¢æµ‹ï¼ˆæ— éœ€æœåŠ¡å™¨ï¼Œç›´æ¥æ‰“å¼€ä½¿ç”¨ï¼‰</p>

<button id="start">å¼€å§‹æ£€æµ‹</button>

<div class="box" id="result">ç­‰å¾…æ£€æµ‹â€¦</div>

<script>
const button = document.getElementById("start");
const result = document.getElementById("result");

button.onclick = async () => {
  button.disabled = true;
  result.innerHTML = "æ£€æµ‹ä¸­ï¼Œè¯·ç¨å€™â€¦";

  const ips = new Set();
  const pc = new RTCPeerConnection({
    iceServers: [
      { urls: "stun:stun.l.google.com:19302" },
      { urls: "stun:stun1.l.google.com:19302" }
    ]
  });

  pc.createDataChannel("test");

  pc.onicecandidate = e => {
    if (!e.candidate) return;
    const match = e.candidate.candidate.match(/(\d+\.\d+\.\d+\.\d+)/);
    if (match) ips.add(match[1]);
  };

  await pc.setLocalDescription(await pc.createOffer());

  setTimeout(() => {
    pc.close();
    const ipList = [...ips];
    let natType = "";
    let level = "ok";

    if (ipList.length === 0) {
      natType = "æ— æ³•è·å– IPï¼ˆå¯èƒ½è¢«æµè§ˆå™¨æˆ–ç½‘ç»œé™åˆ¶ï¼‰";
      level = "bad";
    } else if (ipList.length === 1) {
      natType = "å…¬ç½‘ IP æˆ– Full Cone NATï¼ˆNAT çŠ¶æ€è‰¯å¥½ï¼‰";
    } else {
      natType = "å¯¹ç§° NATï¼ˆSymmetric NATï¼ŒP2P è¿æ¥å›°éš¾ï¼‰";
      level = "bad";
    }

    result.innerHTML = `
      <p><strong>æ£€æµ‹åˆ°çš„ IPï¼š</strong></p>
      <code>${ipList.join("<br>")}</code>
      <hr>
      <p><strong>NAT åˆ¤æ–­ç»“æœï¼š</strong></p>
      <p class="${level}">${natType}</p>
      <p class="warn">è¯´æ˜ï¼šç½‘é¡µç¯å¢ƒä¸‹æ— æ³• 100% ç²¾å‡†ï¼Œä»…ä¾›å‚è€ƒ</p>
    `;

    button.disabled = false;
  }, 3000);
};
</script>

</body>
</html>
